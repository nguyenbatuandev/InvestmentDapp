@model IEnumerable<InvestDapp.Models.Campaign>
@{
    ViewData["Title"] = "Chiến Dịch Của Tôi";
    Layout = "~/Pages/_Layout.cshtml";
}

@section Styles {
<style>
/* ===== BÁM CSS TỪ LAYOUT, KHÔNG DÙNG :root ===== */

/* khung trang */
.mc-wrap{max-width:1200px;margin:calc(var(--header-h,72px) + 32px) auto 64px;padding:0 16px;color:var(--fg)}

/* hero */
.mc-hero{
    background:var(--glass);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:24px 22px;
    margin-bottom:18px
}
.mc-hero h1{margin:0 0 6px;font-weight:800;letter-spacing:.2px;font-size:1.9rem}
.mc-hero p{margin:0;color:var(--muted)}

/* quick actions */
.mc-qacts{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin:14px 0 26px}
.mc-qbtn{
    display:flex;align-items:center;gap:10px;
    padding:10px 12px;border:1px solid var(--border);
    border-radius:12px;background:var(--glass);color:var(--fg);text-decoration:none;
    box-shadow:var(--shadow);transition:transform .16s, box-shadow .16s, border-color .16s
}
.mc-qbtn:hover{transform:translateY(-2px);border-color:color-mix(in oklab,var(--primary) 60%, transparent)}
.mc-qbtn i{opacity:.9}

/* lưới card */
.mc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px}

/* card (đồng cao) */
.mc-card{
    display:flex;flex-direction:column;min-height:380px;
    background:var(--glass);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);overflow:hidden
}
.mc-ch{position:relative;padding:18px 18px 12px;border-bottom:1px solid var(--border)}
.mc-title{font-weight:700;margin:0 0 6px;line-height:1.35}
.mc-title a{color:var(--fg);text-decoration:none}
.mc-title a:hover{color:var(--primary)}
.mc-desc{color:var(--muted);font-size:.95rem;line-height:1.6;margin:0 0 8px}

.mc-badge{
    position:absolute;top:14px;right:14px;padding:6px 10px;border-radius:999px;
    font-weight:800;font-size:.74rem;letter-spacing:.3px;display:inline-flex;align-items:center;gap:6px;
    border:1px solid var(--border);background:var(--card)
}
.badge-pending{color:#ffb800;border-color:color-mix(in oklab,#ffb800 40%, var(--border))}
.badge-approved{color:#00d4aa;border-color:color-mix(in oklab,#00d4aa 40%, var(--border))}
.badge-rejected{color:#ff6b6b;border-color:color-mix(in oklab,#ff6b6b 40%, var(--border))}

/* body linh hoạt để đồng cao */
.mc-cb{display:flex;flex-direction:column;gap:14px;padding:14px 16px;flex:1}

/* stats */
.mc-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.mc-stat{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px;text-align:center}
.mc-stat .v{font-weight:800}
.mc-stat .l{color:var(--muted);font-size:.8rem}

/* tiến độ */
.mc-prog .hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.mc-prog .lbl{font-weight:700}
.mc-prog .pct{font-weight:800;color:var(--primary)}
.mc-bar{height:8px;background:var(--card);border:1px solid var(--border);border-radius:999px;overflow:hidden}
.mc-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));width:0%;transition:width .7s ease}
.mc-prog .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:.8rem;margin-top:6px}

/* time */
.mc-time{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:.9rem}

/* actions: dùng .btn của layout - standardize button sizing/alignment */
.mc-actions{
    margin-top:auto;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:10px;
    /* make each action cell equal height so buttons line up */
    grid-auto-rows:44px;
    align-items:stretch;
}
.mc-actions .btn,
.mc-actions > span {
    width:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:44px;
    box-sizing:border-box;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    color:var(--fg);
    font-weight:800;
    text-decoration:none;
}
.mc-actions .btn.secondary{opacity:.95}
.mc-actions > span{background:transparent;border:0}

/* empty state & notices khớp layout */
.notice{
    background:var(--glass);border:1px solid var(--border);border-left:4px solid;
    border-radius:12px;padding:12px 14px;box-shadow:var(--shadow);margin-bottom:12px
}
.notice.ok{border-left-color:#00d4aa}
.notice.err{border-left-color:#ff6b6b}

.mc-empty{background:var(--glass);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);text-align:center;padding:48px}
.mc-empty i{font-size:44px;opacity:.85;margin-bottom:10px;display:inline-block}
.mc-empty p{color:var(--muted);margin:6px 0 18px}
.mc-empty .btn{
    padding:12px 18px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    vertical-align:middle;
}
.mc-empty .btn i{font-size:1.05em;line-height:1;display:inline-block}

/* responsive */
@@media (max-width:768px){
    .mc-grid{grid-template-columns:1fr}
    .mc-actions{grid-template-columns:1fr}
    .mc-stats{grid-template-columns:1fr}
}
</style>
}

<div class="mc-wrap">
    <div class="mc-hero">
        <h1>Chiến Dịch Của Tôi</h1>
        <p>Quản lý & theo dõi các chiến dịch huy động vốn bạn đã tạo.</p>

        <div class="mc-qacts">
            <a href="@Url.Action("Create")" class="mc-qbtn"><span>Tạo chiến dịch mới</span></a>
            <a href="@Url.Action("Index","Campaigns")" class="mc-qbtn"><i class="fa-solid fa-compass"></i><span>Khám phá dự án</span></a>
            <a href="/Admin" class="mc-qbtn"><i class="fa-solid fa-chart-line"></i><span>Thống kê</span></a>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="notice ok"><i class="fa-solid fa-circle-check"></i> @TempData["SuccessMessage"]</div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="notice err"><i class="fa-solid fa-triangle-exclamation"></i> @TempData["ErrorMessage"]</div>
        }
    </div>

    @if (Model?.Any() == true)
    {
        <div class="mc-grid">
            @foreach (var c in Model.OrderByDescending(x => x.CreatedAt))
            {
                var pct = c.GoalAmount > 0 ? (double)c.CurrentRaisedAmount / (double)c.GoalAmount * 100d : 0d;
                var pctStr = pct.ToString("F2", System.Globalization.CultureInfo.InvariantCulture);

                <article class="mc-card">
                    <header class="mc-ch">
                        @{
                            string badgeCls = "badge-pending"; string badgeText = "Chờ duyệt"; string badgeIcon = "fa-clock";
                            if (c.ApprovalStatus == InvestDapp.Shared.Enums.ApprovalStatus.Approved)
                            {
                                badgeCls = "badge-approved"; badgeText = c.Status switch {
                                    InvestDapp.Shared.Enums.CampaignStatus.Active => "Đang gây quỹ",
                                    InvestDapp.Shared.Enums.CampaignStatus.Completed => "Hoàn thành",
                                    InvestDapp.Shared.Enums.CampaignStatus.Voting => "Đang bỏ phiếu",
                                    _ => "Đã duyệt"
                                };
                                badgeIcon = c.Status switch {
                                    InvestDapp.Shared.Enums.CampaignStatus.Active => "fa-play",
                                    InvestDapp.Shared.Enums.CampaignStatus.Completed => "fa-check-circle",
                                    InvestDapp.Shared.Enums.CampaignStatus.Voting => "fa-vote-yea",
                                    _ => "fa-check"
                                };
                            }
                            else if (c.ApprovalStatus == InvestDapp.Shared.Enums.ApprovalStatus.Rejected)
                            { badgeCls="badge-rejected"; badgeText="Bị từ chối"; badgeIcon="fa-times-circle"; }
                        }
                        <div class="mc-badge @badgeCls"><i class="fa-solid @badgeIcon"></i>@badgeText</div>

                        <h3 class="mc-title">
                            <a href="@Url.Action("Details", new { id = c.Id })">@c.Name</a>
                        </h3>
                        <p class="mc-desc">@c.ShortDescription</p>
                        <div class="mc-time"><i class="fa-regular fa-calendar"></i>
                            <span>Tạo lúc @c.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>
                        </div>
                    </header>

                    <div class="mc-cb">
                        <div class="mc-stats">
                            <div class="mc-stat">
                                <div class="v">@c.GoalAmount</div>
                                <div class="l">Mục tiêu (BNB)</div>
                            </div>
                            <div class="mc-stat">
                                <div class="v">@c.CurrentRaisedAmount</div>
                                <div class="l">Đã huy động (BNB)</div>
                            </div>
                        </div>

                        <div class="mc-prog">
                            <div class="hd">
                                <div class="lbl">Tiến độ</div>
                                <div class="pct">@((c.GoalAmount>0? (c.CurrentRaisedAmount/c.GoalAmount*100).ToString("F1"):"0"))%</div>
                            </div>
                            <div class="mc-bar">
                                <div class="mc-fill" style="width:@pctStr%"></div>
                            </div>
                            <div class="meta">
                                <span>@c.InvestorCount nhà đầu tư</span>
                                <span>@((c.EndTime - DateTime.UtcNow).Days) ngày còn lại</span>
                            </div>
                        </div>

                        <div class="mc-actions">
                            <a class="btn" href="@Url.Action("Details", new { id = c.Id })"><i class="fa-solid fa-eye"></i>&nbsp;Details</a>
                            <a class="btn" href="@Url.Action("Dashboard", new { id = c.Id })"><i class="fa-solid fa-gauge-high"></i>&nbsp;Dashboard</a>

                            @if (c.ApprovalStatus == InvestDapp.Shared.Enums.ApprovalStatus.Approved)
                            {
                                <a class="btn secondary" href="@Url.Action("Posts", new { campaignId = c.Id })"><i class="fa-solid fa-newspaper"></i>&nbsp;Post</a>
                            }
                            else if (c.ApprovalStatus == InvestDapp.Shared.Enums.ApprovalStatus.Pending)
                            {
                                <a class="btn secondary" href="@Url.Action("AwaitingApproval", new { campaignId = c.Id })"><i class="fa-regular fa-hourglass-half"></i>&nbsp;Theo dõi</a>
                            }
                            else
                            {
                                <span></span>
                            }
                        </div>
                    </div>
                </article>
            }
        </div>
    }
    else
    {
        <div class="mc-empty">
            <i class="fa-solid fa-rocket"></i>
            <h3 style="margin:0 0 6px;font-weight:800">Chưa có chiến dịch nào</h3>
            <p>Hãy bắt đầu biến ý tưởng của bạn thành hiện thực.</p>
            <a href="@Url.Action("Create")" class="btn"><i class="fa-solid fa-plus"></i>&nbsp;Tạo chiến dịch đầu tiên</a>
        </div>
    }
</div>

@section Scripts{
<script>
document.addEventListener('DOMContentLoaded',()=> {
    // animate progress width sau khi mount
    requestAnimationFrame(()=> {
        document.querySelectorAll('.mc-fill').forEach(el=>{
            const w = el.style.width; el.style.width='0%';
            setTimeout(()=> el.style.width = w, 50);
        });
    });
});
</script>
}
